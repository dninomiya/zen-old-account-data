---
title: "npmãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¬é–‹ã™ã‚‹ï¼ˆTypeScriptã€CDNå¯¾å¿œï¼‰"
emoji: "ğŸ‘¨â€ğŸ’»"
type: "tech"
topics:
  - "npmå…¬é–‹"
published: true
published_at: "2021-11-22 20:04"
---

jQueryã®ã‚ˆã†ã«CDNã§ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã—ã€TypeScriptç­‰ã§å‹ä»˜ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã€‚ãã‚“ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’é–‹ç™º&å…¬é–‹ã™ã‚‹æ‰‹é †ã§ã™ã€‚ãƒŸãƒ‹ãƒãƒ æ§‹æˆãªã®ã§é©å®œwebpackã‚„tsconfigã‚’èª¿æ•´ã—ã¦ãã ã•ã„ã€‚

# äº‹å‰æº–å‚™

- [npmã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ](https://www.npmjs.com/signup)
- ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§npmã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹
- ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç”¨ã®å…¬é–‹GitHubãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆ

```bash
npm login
npm whoami # ã‚¢ã‚«ã‚¦ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚Œã°OK
```

# ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåˆæœŸåŒ–

```bash
# ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ
mkdir demo-library
cd demo-library

# package.jsonã‚’ã‚¹ã‚³ãƒ¼ãƒ—ä»˜ãã§åˆæœŸåŒ–
npm init --scope=@scope-name

# é–‹ç™ºç”¨ãƒãƒ³ãƒ‰ãƒ«ãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
npm i -D ts-loader typescript webpack webpack-cli
touch tsconfig.json webpack.config.js

# ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
mkdir src
touch src/cdn.ts src/index.ts
```

ä¸Šè¨˜ã®ä¸­ã§`@scope-name` ã¯npmã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ï¼ˆä¾‹: `--scope=@nino_cast`ï¼‰

```js:webpack.config.js
module.exports = {
  mode: 'production',
  entry: './src/cdn.ts',
  module: {
    rules: [
      {
        test: /\.ts$/,
        use: 'ts-loader',
      },
    ],
  },
  resolve: {
    extensions: ['.ts', '.js'],
  },
};
```

```json:tsconfig.json
{
  "compilerOptions": {
    "target": "es2016",
    "module": "ES2015",
    "moduleResolution": "node",
    "declaration": true,
    "outDir": "./dist",
    "esModuleInterop": true,
    "forceConsistentCasingInFileNames": true,
    "strict": true,
    "skipLibCheck": true,
    "lib": ["ES2020", "DOM"]
  },
  "include": ["src"]
}
```

```json:package.json
{
  "name": "<è‡ªå‹•å…¥åŠ›ã•ã‚ŒãŸã¾ã¾ã§OK>",
  "version": "1.0.0",
  "description": "<ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª¬æ˜>",
  "main": "dist/index.js",
  "types": "dist/index.d.ts",
  "scripts": {
    "prepublishOnly": "npm run build", # npmå…¬é–‹å‰ã«è‡ªå‹•ã§èµ°ã‚‹
    "build": "tsc && webpack"
  },
  "files": [
    "dist/main.js",
    "dist/index.js",
    "dist/index.d.ts"
  ],
  "repository": {
    "type": "git",
    "url": "<ãƒªãƒã‚¸ãƒˆãƒªURL>"
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    // ...
  },
  "devDependencies": {
    // ...
  }
}
```

æ¦‚è¦ã¨ã—ã¦ã¯ä»¥ä¸‹ã‚’è¡Œã„ã¾ã™ã€‚CDNåˆ©ç”¨ãŒä¸è¦ã§ã‚ã‚Œã°webpackã‚„CDNã®å¯¾å¿œã¯ä¸è¦ã§ã™ã€‚

webpack â†’ cdn.ts ã®å†…å®¹ã‚’CDNå…¬é–‹ç”¨ã«ãƒ“ãƒ«ãƒ‰ã™ã‚‹
tsc â†’ tsãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç”¨ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹

## ä¸è¦ãƒ•ã‚¡ã‚¤ãƒ«ã®é™¤å¤–

```plane:.gitignore
node_modules
dist
```

# ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™º

ä»Šå›ã¯æŒ‡å®šIDã®Elementã«ç¾åœ¨æ—¥æ™‚ã‚’è¡¨ç¤ºã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
npm i date-fns
```

```ts:src/index.ts
import { format } from 'date-fns';

export const renderClock = function (id: string): void {
  const element = document.getElementById(id);
  setInterval(() => {
    if (element) {
      element.innerHTML = format(new Date(), 'yyyyå¹´MMæœˆddæ—¥ HH:mm:ss');
    }
  }, 1000);
};
```

ã“ã‚Œã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã§ããŸã®ã§ã€CDNå…¬é–‹ç”¨ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«ï¼ˆwindowï¼‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¶ã‚‰ä¸‹ã’ã¾ã—ã‚‡ã†ã€‚

```ts:src/cdn.ts
import { renderClock } from '.';

(<any>window).renderClock = renderClock;
```

ã“ã‚Œã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå®Ÿè£…çµ‚äº†ã§ã™ã€‚

# ãƒ†ã‚¹ãƒˆ

ã„ããªã‚Šnpmã«å…¬é–‹ã™ã‚‹ã®ã§ã¯ãªãã¾ãšã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚ã¾ãšã¯ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã£ãŸä¸Šã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã« `npm link` ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
npm run build
npm link
```

æ¨©é™ãŒãªã„å ´åˆ `sudo npm link` ã¨ã—ã¦ãã ã•ã„ã€‚

æ¬¡ã«ãƒ†ã‚¹ãƒˆç”¨ã«é©å½“ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
mkdir lib-test
cd lib-test
npm i typescript webpack webpack-cli ts-loader
touch webpack.config.js tsconfig.json main.ts
npm link <ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå> #ãŸã¨ãˆã° @nino_cast/demo-library
```

```js:webpack.config.js
module.exports = {
  mode: 'development',
  entry: './main.ts',
  module: {
    rules: [
      {
        test: /\.ts$/,
        use: 'ts-loader',
      },
    ],
  },
  resolve: {
    extensions: ['.ts', '.js'],
  },
};
```

```json:tsconfig.json
{
  "compilerOptions": {
    "target": "es2016",
    "module": "ES2015",
    "moduleResolution": "node",
    "outDir": "./dist",
    "esModuleInterop": true,
    "forceConsistentCasingInFileNames": true,
    "strict": true,
    "skipLibCheck": true,
  }
}
```

```ts:main.ts
import { renderClock } from '@ã‚¹ã‚³ãƒ¼ãƒ—/ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå';

renderClock('clock');
```

```html:index.html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script defer src="./dist/main.js"></script>
</head>
<body>
  <div id="clock"></div>

</body>
</html>
```

```json:package.json
# ä»¥ä¸‹ã‚’è¿½åŠ 
"scripts": {
  "build": "webpack"
},
```

ä»¥å¾Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ `npm run buil` ã‚’å©ã‘ã°è‡ªå‹•ã§æœ€æ–°ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒåæ˜ ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## ãƒ†ã‚¹ãƒˆçµ‚äº†å¾Œã®å¾Œå§‹æœ«

ãƒ†ã‚¹ãƒˆãŒçµ‚ã‚ã£ãŸã‚‰å¿…ãšunlinkã‚’è¡Œã„ã¾ã—ã‚‡ã†ã€‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ãƒ†ã‚¹ãƒˆç”¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸¡æ–¹ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
npm unlink <@ã‚¹ã‚³ãƒ¼ãƒ—/ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå>
```

## CDNå‹•ä½œã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚§ãƒƒã‚¯

CDNåˆ©ç”¨ã®å‹•ä½œã‚’ç¢ºèªã—ãŸã„å ´åˆã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸Šã®`dist/main.js` ã‚’èª­ã¿è¾¼ã‚ã°è‰¯ã„ã§ã—ã‚‡ã†ã€‚
	
```html:cdn.html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="<PCä¸Šã®ãƒ‘ã‚¹>/main.js"></script>
</head>
<body>
  <div id="clock"></div>
  <script>
    renderClock('clock')
  </script>
</body>
</html>
```

# å…¬é–‹

å•é¡Œãªã‘ã‚Œã°å…¬é–‹ã—ã¾ã™ã€‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
npm publish --access=public
```

ã¡ãªã¿ã«åŒã˜ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å…¬é–‹ã™ã‚‹ã“ã¨ã¯ã§ããªã„ã®ã§ä¿®æ­£ã‚’åŠ ãˆãŸå ´åˆä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã—ã¦ã‹ã‚‰å…¬é–‹ã—ã¦ãã ã•ã„ã€‚ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®ç¨®é¡å¤‰æ›´ï¼ˆãƒ¡ã‚¸ãƒ£ãƒ¼ã€ãƒã‚¤ãƒŠãƒ¼ï¼‰ã‚„ä»˜éšã™ã‚‹è‡ªå‹•åŒ–ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¯[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.npmjs.com/cli/v8/commands/npm-version)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

```bash
npm version patch -m "ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆå†…å®¹"
npm publish
```

# å®Ÿéš›ã«ä½¿ã£ã¦ã¿ã‚‹

## CDNã®åˆ©ç”¨

[jsDelivr](https://www.jsdelivr.com/)ã¯å…¬é–‹ã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è‡ªå‹•ã§CDNã«ãƒ›ã‚¹ãƒˆã—ã¦ãã‚Œã¾ã™ã€‚ç‰¹ã«ä½•ã‚’ã™ã‚‹ã“ã¨ã‚‚ãªãä»¥ä¸‹ã®ã‚ˆã†ã«ã„ããªã‚Šä½¿ãˆã¾ã™ã€‚

```html
<script src="https://cdn.jsdelivr.net/npm/@ã‚¹ã‚³ãƒ¼ãƒ—/ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå@ãƒãƒ¼ã‚¸ãƒ§ãƒ³/dist/main.min.js"></script>
```

ä¾‹
```html
<script src="https://cdn.jsdelivr.net/npm/@nino_cast/simple-clock@1.0.1/dist/main.min.js"></script>
```

è‡ªå‹•ã§åœ§ç¸®ãƒ•ã‚¡ã‚¤ãƒ« `min.js` ã‚’ä½œã£ã¦ãã‚Œã‚‹ã®ã§ãã¡ã‚‰ã‚’ä½¿ã†ã®ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’çœç•¥ã™ã‚‹ã¨å¸¸ã«æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå‚ç…§ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã•ã¾ã–ã¾ãªå‘¼ã³å‡ºã—æ–¹ãŒã‚ã‚‹ã®ã§[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§](https://www.jsdelivr.com/features)ã—ã¦ãã ã•ã„ã€‚

## ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä½¿ç”¨

TypeScriptãŒä½¿ãˆã‚‹ç’°å¢ƒã§ä¸€èˆ¬çš„ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªåŒæ§˜ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```bash
npm i @ã‚¹ã‚³ãƒ¼ãƒ—å/ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå
```

## ãŠã¾ã‘

[TypeScript library starter
](https://github.com/alexjoverm/typescript-library-starter)ã‚’ä½¿ãˆã°ãƒ†ã‚¹ãƒˆãªã©å…¨éƒ¨å…¥ã‚Šã®çŠ¶æ…‹ã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºã‚’ã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚CDNé…å¸ƒã™ã‚‹å ´åˆå‰è¿°ã®é€šã‚Šwebpackã«ã‚ˆã‚‹é…å¸ƒç”¨ãƒãƒ³ãƒ‰ãƒ«ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã§ã™ãŒã€ä¸€èˆ¬çš„ãªTypeScriptãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚Œã°CDNé…æ…®ã¯ä¸è¦ã ã¨æ€ã†ã®ã§ã“ã¡ã‚‰ã®ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ã‚­ãƒƒãƒˆã‹ã‚‰é–‹ç™ºã™ã‚‹ã®ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ã€‚

---

- [ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰](https://github.com/nino-cast/simple-clock)
